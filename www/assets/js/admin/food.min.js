$(function(){function e(){var e=[];return $("#setmealList .item").each(function(n,t){var r="",a=$(t);r=a.find(".name").text()+"|"+a.find(".price").text()+"|"+a.find(".num").text(),e.push(r)}),e.length?void $("#setmeal").val(e):void $("#setmeal").val("")}function n(){var e=[];return $("#banners img").each(function(n,t){e.push($(t).attr("data-src"))}),e.length?void $("#banner").val(e):void $("#banner").val("")}function t(){var e=[];return $("#contents img").each(function(n,t){e.push($(t).attr("data-src"))}),e.length?($("#content").val(e),void console.log($("#content").val())):void $("#content").val("")}$("#addForm").validate({ignore:[],rules:{name:{required:!0,remote:{url:"/admin/food/check",type:"POST"}},banner:{required:!0},content:{required:!0},price:{required:!0},sold:{required:!0},setmeal:{required:!0},shopid:{required:!0},intro:{required:!0}},messages:{name:{required:"必填项",remote:"已存在"},banner:{required:"必填项"},content:{required:"必填项"},price:{required:"必填项"},sold:{required:"必填项"},setmeal:{required:"必填项"},shopid:{required:"必填项"},intro:{required:"必填项"}},submitHandler:function(e){var n=$("#addForm").serialize(),t=$("#id").val();if(t)var r="/admin/food/edit";else var r="/admin/food/add";$.post(r,n,function(e){return e.errno?void alert(e.errmsg):void(window.location.href="/admin/food")})}}),$("#id").val()&&$("#name").rules("remove","remote"),$("#foodsTable").on("click",".del",function(){var e=$(this).parents("tr"),n=e.find("td").eq(0).text();$.post("/admin/food/del",{id:n},function(n){return n.errno?void alert(n.errmsg):(e.remove(),void($("#foodsTable tbody tr").length||$("#foodsTable tbody").append($('<tr><td colspan="5">暂时没有美食上架，刷新页面试试</td></tr>'))))})}),$(".fnNum").on("keypress",function(e){var n=e.which;return 46==n||n>=8&&57>=n||8==n?!0:!1}),$("#setmealList .tool .ui-btn").on("click",function(){var n=$(this).parents(".tool"),t=n.find(".name").val(),r=n.find(".price").val(),a=n.find(".num").val();return t&&r&&a?(n.find(".name").val(""),n.find(".price").val(""),n.find(".num").val(""),n.before($('<div class="item"><span class="name">'+t+'</span><span class="price">'+r+'</span><span class="num">'+a+'</span><span class="x">&times;</span></div>')),void e()):void alert("信息不全")}),$("#setmealList").on("click",".x",function(){$(this).parents(".item").remove(),e()}),$("#upBanner").on("change",function(){var e=new XMLHttpRequest;e.onreadystatechange=function(t){4==e.readyState&&200==e.status&&($("#banners").append($('<li><img src="'+e.responseText+'" data-src="'+e.responseText+'"/><span class="x">&times;</span></li>')),n())},e.open("POST","/admin/food/addimg",!0),e.setRequestHeader("X-FILENAME","file"),e.send($("#upBanner")[0].files[0])}),$("#banners").on("click",".x",function(){$(this).parent().remove(),n()}),$("#upContent").on("change",function(){var e=new XMLHttpRequest;e.onreadystatechange=function(n){4==e.readyState&&200==e.status&&($("#contents").append($('<li><img src="'+e.responseText+'" data-src="'+e.responseText+'"/><span class="x">&times;</span></li>')),t())},e.open("POST","/admin/food/addimg",!0),e.setRequestHeader("X-FILENAME","file"),e.send($("#upContent")[0].files[0])}),$("#contents").on("click",".x",function(){$(this).parent().remove(),t()})});