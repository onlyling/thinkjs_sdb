$(function(){$("#addForm").validate({ignore:[],rules:{name:{required:!0,remote:{url:"/admin/shop/check",type:"POST"}},logo:{required:!0},cover:{required:!0},tel:{required:!0},address:{required:!0},intro:{required:!0}},messages:{name:{required:"必填项",remote:"已存在"},logo:{required:"必填项"},cover:{required:"必填项"},tel:{required:"必填项"},address:{required:"必填项"},intro:{required:"必填项"}},submitHandler:function(){var e=$("#addForm").serialize(),r=$("#id").val();if(r)var o="/admin/shop/edit";else var o="/admin/shop/add";$.post(o,e,function(e){return e.errno?void alert(e.errmsg):void(window.location.href="/admin/shop")})}}),$("#id").val()&&$("#name").rules("remove","remote"),$("#shopsTable").on("click",".del",function(){var e=$(this).parents("tr"),r=e.find("td").eq(0).text();$.post("/admin/shop/del",{id:r},function(r){return r.errno?void alert(r.errmsg):(e.remove(),void($("#shopsTable tbody tr").length||$("#shopsTable tbody").append($('<tr><td colspan="4">暂时没有餐店入驻，刷新页面试试</td></tr>'))))})}),$("#upLogo").on("change",function(){var e=new XMLHttpRequest;e.onreadystatechange=function(r){4==e.readyState&&200==e.status&&($("#imgLogo").addClass("img-logo").attr("src",e.responseText),$("#logo").val(e.responseText))},e.open("POST","/admin/shop/addimg",!0),e.setRequestHeader("X-FILENAME","file"),e.send($("#upLogo")[0].files[0])}),$("#upCover").on("change",function(){var e=new XMLHttpRequest;e.onreadystatechange=function(r){4==e.readyState&&200==e.status&&($("#imgCover").addClass("img-cover").attr("src",e.responseText),$("#cover").val(e.responseText))},e.open("POST","/admin/shop/addimg",!0),e.setRequestHeader("X-FILENAME","file"),e.send($("#upCover")[0].files[0])})});