$(function(){function e(e,t,a,i){var n=e||"new",l=t||"",d=a||"",r=i||"";if("new"==n)var s="添加会员",u="确认添加";else var s="编辑会员",u="确认修改";var m=$('<form class="userbox ui-alertbox"><h2 class="ui-title">'+s+'<span class="x">&times;</span></h2><input type="hidden" name="id" id="id" value="'+n+'" /><ul class="ul"><li><label for="name">用户名：</label><input type="text" name="name" id="name" class="ui-text" value="'+l+'" /></li><li><label for="pwd">密码：</label><input type="text" name="pwd" id="pwd" class="ui-text" value="'+d+'" /></li><li><label for="email">邮箱：</label><input type="text" name="email" id="email" class="ui-text" value="'+r+'"></li><li><label></label><input type="submit" class="ui-btn" value="'+u+'"></li></ul></form>');$("body").append(m),m.on("click",".x",function(){m.remove()}),m.validate({rules:{name:{required:!0,remote:{url:"/admin/user/check",type:"POST"}},pwd:{required:!0,minlength:5},email:{required:!0,remote:{url:"/admin/user/check",type:"POST"}}},messages:{name:{required:"必填项",remote:"已注册"},pwd:{required:"必填项",minlength:"密码不能小于{0}个字符"},email:{required:"必填项",remote:"已注册"}}}),m.on("click",".ui-btn",function(e){e.preventDefault();var t={id:$("#id").val(),name:$("#name").val(),pwd:$("#pwd").val(),email:$("#email").val()};t.name&&t.pwd&&t.email&&("new"==t.id?$.post("/admin/user/add",t,function(e){e.errno&&alert(e.errmsg);var a="<tr><td>"+e.data+"</td><td>"+t.name+"</td><td>"+t.email+'</td><td><span class="edit">编辑</span><span class="del">删除</span></td></tr>';$("#nousers").length&&$("#nousers").remove(),$("#usersTable").append(a),m.remove()}):$.post("/admin/user/edit",t,function(e){if(e.errno)return void alert(e.errmsg);var a="<td>"+t.id+"</td><td>"+t.name+"</td><td>"+t.email+'</td><td><span class="edit">编辑</span><span class="del">删除</span></td>';$("#thisId").html(a),m.remove()}))})}$("#add").on("click",function(){e()}),$("#usersTable").on("click",".edit",function(){var t=$(this).parents("tr"),a=t.find("td").eq(0).text();t.attr("id","thisId"),$.post("/admin/user/getuser",{id:a},function(t){e(t.data.id,t.data.name,t.data.pwd,t.data.email)})}),$("#usersTable").on("click",".del",function(){var e=$(this).parents("tr"),t=e.find("td").eq(0).text();$.post("/admin/user/del",{id:t},function(t){return t.errno?void alert(t.errmsg):(e.remove(),void($("#usersTable tbody tr").length||$("#usersTable tbody").append($('<tr id="nousers"><td colspan="4">暂时没有人注册成为会员，刷新页面试试</td></tr>'))))})})});